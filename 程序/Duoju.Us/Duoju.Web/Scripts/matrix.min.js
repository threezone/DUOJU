$(document).ready(function(){$("#header_nav").click(function(){window.document.location.href="/"
});
var f=$(window).width();
ycf_crm.getCurrentUser(null,function(a){$("#welcome_msg").html(" Welcome "+a.UserName);
$("#hidAdminUserId").val(a.Usid)
},null);
ycf_crm.getMenu(null,function(c){if(c.length){var b=window.document.location.pathname;
var a="";
$.each(c,function(e){var d=ycf_crm.stringFormat('<a href="{0}" title="{1}" class="tip-bottom"><i class="{2}"></i>{3}</a>',c[e].UrlPath,"返回"+c[e].ActionName,c[e].Icon,c[e].ActionName);
_breadcrumbSub="";
if(c[e].SubMenu!=""){var r=false;
var s=false;
var q=true;
a+=ycf_crm.stringFormat('<li class="submenu __isOpen__"><a href="#"><i class="icon {0}"></i><span>{1}</span></a><ul>',c[e].Icon,c[e].ActionName);
$.each(c[e].SubMenu,function(k){if(b==c[e].SubMenu[k].UrlPath){r=true;
_breadcrumbSub="";
d+=ycf_crm.stringFormat('<a href="{0}" title="{1}" class="tip-bottom"><i class="{2}"></i>{3}</a>',c[e].SubMenu[k].UrlPath,"返回"+c[e].SubMenu[k].ActionName,c[e].SubMenu[k].Icon,c[e].SubMenu[k].ActionName);
if(f>480){a+=ycf_crm.stringFormat('<li {0}><a href="{1}">{2}</a></li>','class="active"',c[e].SubMenu[k].UrlPath,c[e].SubMenu[k].ActionName)
}else{a+=ycf_crm.stringFormat('<li {0}><a href="{1}">{2}</a></li>',"",c[e].SubMenu[k].UrlPath,c[e].SubMenu[k].ActionName)
}q=false
}else{$.each(c[e].SubMenu[k].SubMenu,function(l){if(c[e].SubMenu[k].SubMenu[l].UrlPath==b){s=true;
d+=ycf_crm.stringFormat('<a href="{0}" title="{1}" class="tip-bottom"><i class="{2}"></i>{3}</a>',c[e].SubMenu[k].UrlPath,"返回"+c[e].SubMenu[k].ActionName,c[e].SubMenu[k].Icon,c[e].SubMenu[k].ActionName);
_breadcrumbSub=ycf_crm.stringFormat('<a href="{0}" title="{1}" class="tip-bottom"><i class="{2}"></i>{3}</a>',c[e].SubMenu[k].SubMenu[l].UrlPath,"返回"+c[e].SubMenu[k].SubMenu[l].ActionName,c[e].SubMenu[k].SubMenu[l].Icon,c[e].SubMenu[k].SubMenu[l].ActionName)
}});
a+=ycf_crm.stringFormat('<li><a href="{0}">{1}</a></li>',c[e].SubMenu[k].UrlPath,c[e].SubMenu[k].ActionName)
}});
if(r||s){$("#breadcrumb").html(d+_breadcrumbSub);
d=_breadcrumbSub="";
if(f>480){a=a.replace(/__isOpen__/g,"open")
}else{a=a.replace(/__isOpen__/g,"")
}}else{a=a.replace(/__isOpen__/g,"")
}a+="</ul></li>"
}else{var p=(b==c[e].UrlPath||b=="/");
if(f>480){a+=ycf_crm.stringFormat('<li {0}><a href="{1}"><i class="icon {2}"></i><span>{3}</span></a></li>',(p?'class="active"':""),c[e].UrlPath,c[e].Icon,c[e].ActionName)
}else{a+=ycf_crm.stringFormat('<li {0}><a href="{1}"><i class="icon {2}"></i><span>{3}</span></a></li>',"",c[e].UrlPath,c[e].Icon,c[e].ActionName)
}if(p){$("#breadcrumb").html(d)
}}});
$("#MainMenu").html(a);
$(".tip").tooltip();
$(".tip-left").tooltip({placement:"left"});
$(".tip-right").tooltip({placement:"right"});
$(".tip-top").tooltip({placement:"top"});
$(".tip-bottom").tooltip({placement:"bottom"})
}},function(a){console.log(a)
});
$(".submenu > a").live("click",function(a){a.preventDefault();
var c=$(this).siblings("ul");
var b=$(this).parents("li");
var d=$("#sidebar li.submenu ul");
var e=$("#sidebar li.submenu");
if(b.hasClass("open")){if(($(window).width()>768)||($(window).width()<479)){c.slideUp()
}else{c.fadeOut(250)
}b.removeClass("open")
}else{if(($(window).width()>768)||($(window).width()<479)){d.slideUp();
c.slideDown()
}else{d.fadeOut(250);
c.fadeIn(250)
}e.removeClass("open");
b.addClass("open")
}});
var j=$("#sidebar > ul");
$("#sidebar > a").live("click",function(a){a.preventDefault();
var b=$("#sidebar");
if(b.hasClass("open")){b.removeClass("open");
j.slideUp(250)
}else{b.addClass("open");
j.slideDown(250)
}});
$(window).resize(function(){if($(window).width()>479){j.css({display:"block"});
$("#content-header .btn-group").css({width:"auto"})
}if($(window).width()<479){j.css({display:"none"});
g()
}if($(window).width()>768){$("#user-nav > ul").css({width:"auto",margin:"0"});
$("#content-header .btn-group").css({width:"auto"})
}});
if($(window).width()<468){j.css({display:"none"});
g()
}if($(window).width()>479){$("#content-header .btn-group").css({width:"auto"});
j.css({display:"block"})
}$("#search input[type=text]").typeahead({source:["Dashboard","Form elements","Common Elements","Validation","Wizard","Buttons","Icons","Interface elements","Support","Calendar","Gallery","Reports","Charts","Graphs","Widgets"],items:4});
function g(){var b=$("#user-nav > ul").width();
$("#user-nav > ul").css({width:b,"margin-left":"-"+b/2+"px"});
var a=$("#content-header .btn-group").width();
$("#content-header .btn-group").css({width:a,"margin-left":"-"+b/2+"px"})
}$("#style-switcher i").click(function(){if($(this).hasClass("open")){$(this).parent().animate({marginRight:"-=190"});
$(this).removeClass("open")
}else{$(this).parent().animate({marginRight:"+=190"});
$(this).addClass("open")
}$(this).toggleClass("icon-arrow-left");
$(this).toggleClass("icon-arrow-right")
});
$("#style-switcher a").click(function(){var a=$(this).attr("href").replace("#","");
$(".skin-color").attr("href","css/maruti."+a+".css");
$(this).siblings("a").css({"border-color":"transparent"});
$(this).css({"border-color":"#aaaaaa"})
});
$(".lightbox_trigger").click(function(a){a.preventDefault();
var b=$(this).attr("href");
if($("#lightbox").length>0){$("#imgbox").html('<img src="'+b+'" /><p><i class="icon-remove icon-white"></i></p>');
$("#lightbox").slideDown(500)
}else{var c='<div id="lightbox" style="display:none;"><div id="imgbox"><img src="'+b+'" /><p><i class="icon-remove icon-white"></i></p></div></div>';
$("body").append(c);
$("#lightbox").slideDown(500)
}});
$("#lightbox").live("click",function(){$("#lightbox").hide(200)
});
$("#EditTask").click(function(){$("#TaskEditPanel").show();
$("#TaskEditInfo").show()
});
$("#btnCancelEditTask").click(function(){$("#TaskEditPanel").hide();
$("#TaskEditInfo").hide()
});
ycf_crm.getFollowState(null,function(a){if(a&&a.length>0){$.each(a,function(b){var c=ycf_crm.stringFormat('<option value="{0}">{1}</option>',a[b].StateId,a[b].State);
$("#taskFollowLogState").append(c)
})
}},function(a){console.log(a)
});
var h=$("#divTaskStartDate").datetimepicker({format:"yyyy-mm-dd hh:ii",autoclose:true}).on("changeDate",function(a){var b=new Date(a.date);
b.setDate(b.getDate()-1);
$("#divTaskEndDate").datetimepicker("setStartDate",b);
$("#divTaskEndDate")[0].focus()
});
var i=$("#divTaskEndDate").datetimepicker({format:"yyyy-mm-dd hh:ii",autoclose:true,onRender:function(a){return a.valueOf()<=h.date.valueOf()?"disabled":""
}});
$("#FlagTask").click(function(){var a={};
if($("#fullcalendar").length>0){a=$("#fullcalendar").fullCalendar("clientEvents",$("#currentTaskId").val())
}else{a=ycf_async.findEventById($("#currentTaskId").val())
}if(a[0].taskState!=3){ycf_crm.readTask($("#currentTaskId").val(),3,null,function(b){a[0].className="fc-event-skin-important";
a[0].taskState=3;
$("#FlagTask").attr("style","color:#f74d4d;");
if($("#fullcalendar").length>0){$("#fullcalendar").fullCalendar("updateEvent",a[0],true)
}$("#CancelTask").find("i").removeAttr("style");
ycf_async.updateEventStateById($("#currentTaskId").val(),3)
},function(b){console.log(b)
})
}});
$("#CancelTask").click(function(){var a={};
if($("#fullcalendar").length>0){a=$("#fullcalendar").fullCalendar("clientEvents",$("#currentTaskId").val())
}else{a=ycf_async.findEventById($("#currentTaskId").val())
}if(a[0].taskState!=4){ycf_crm.readTask($("#currentTaskId").val(),4,null,function(b){a[0].className="fc-event-skin-cancel";
a[0].taskState=4;
$("#CancelTask").find("i").attr("style","color:#f74d4d;");
$("#CancelTask").find("i").removeClass("icon-remove");
$("#CancelTask").find("i").addClass("icon-ban-circle");
$("#FlagTask").removeAttr("style");
if($("#fullcalendar").length>0){$("#fullcalendar").fullCalendar("updateEvent",a[0],true)
}ycf_async.updateEventStateById($("#currentTaskId").val(),4)
},function(b){console.log(b)
})
}});
$(".sp_gritter").live("click",function(){var a=ycf_async.findEventById($(this).attr("eid"));
$("#currentTaskId").val($(this).attr("eid"));
$("#currentSupplierId").val(a[0].supplierId);
$("#lbTaskTitle").html("<strong>"+a[0].title+"</strong> ");
$("#taskStartDate").val(a[0].start.toString("yyyy/MM/dd hh:mm"));
$("#taskEndDate").val((a[0].end==null?a[0].start.toString("yyyy/MM/dd hh:mm"):a[0].end.toString("yyyy.MM.dd hh:mm")));
$("#editTaskContent").val(a[0].content);
$("#spanTimeDiff").html("开始: "+a[0].start.toString("yyyy.MM.dd hh:mm")+"&nbsp;&nbsp;&nbsp;&nbsp;结束:"+(a[0].end==null?a[0].start.toString("yyyy.MM.dd hh:mm"):a[0].end.toString("yyyy.MM.dd hh:mm")));
$("#lbTaskContent").html(a[0].content);
$("#currentTaskId").val(a[0].id);
if(a[0].taskState==1){$("#FlagTask").removeAttr("style");
$("#CancelTask").find("i").removeClass("icon-ban-circle");
$("#CancelTask").find("i").addClass("icon-remove");
$("#CancelTask").find("i").removeAttr("style");
ycf_crm.readTask(a[0].id,2,null,function(b){a[0].className="fc-event-skin-flag";
if($("#fullcalendar").length>0){$("#fullcalendar").fullCalendar("updateEvent",event)
}ycf_async.updateEventStateById(a[0].id,2)
},function(b){console.log(b)
})
}else{if(a[0].taskState==3){$("#FlagTask").attr("style","color:#f74d4d;");
$("#CancelTask").find("i").removeClass("icon-ban-circle");
$("#CancelTask").find("i").addClass("icon-remove");
$("#CancelTask").find("i").removeAttr("style")
}else{if(a[0].taskState==4){$("#CancelTask").find("i").removeClass("icon-remove");
$("#CancelTask").find("i").addClass("icon-ban-circle");
$("#CancelTask").find("i").attr("style","color:#f74d4d;");
$("#FlagTask").removeAttr("style")
}else{$("#CancelTask").find("i").removeClass("icon-ban-circle");
$("#CancelTask").find("i").addClass("icon-remove");
$("#FlagTask").removeAttr("style");
$("#CancelTask").find("i").removeAttr("style")
}}}});
$("#followLogAndTaskForm").ajaxForm({dataType:"json",success:function(a){ycf_async.updateEventStateById($("#currentTaskId").val(),$("#taskState").val());
$("#TaskEditPanel").hide();
$("#TaskEditInfo").hide();
$("#modal-showTask").modal("hide");
$("#myModal").modal();
$("#followLogAndTaskForm").clearForm();
if($("#tb_followLog").length>0){$("#tb_followLog").datagrid("reload")
}if($("#tb_task").length>0){$("#tb_task").datagrid("reload")
}}})
});